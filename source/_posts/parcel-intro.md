---
title: 全新打包工具-Parcel介绍
date: 2017-12-07 15:10:45
tags: [js]
---

## Parcel的特性
* 快速打包 - 多核编译，以及文件系统缓存，即使在重新启动之后也能快速重新构建。
* 支持JS，CSS，HTML，文件资源等- 不需要安装任何插件。
* 在需要的时候自动使用Babel，PostCSS和PostHTML自动转换模块 - 甚至是node_modules。
* 零配置代码拆分，使用动态import语句分割。
* 内置支持模块热替换
* 友好的错误记录体验，语法突出显示的代码帧有助于查明问题。

## 比较

基于一个合理大小的应用程序，包含1726个模块，未压缩有6.5M 。构建在2016年的MAcBook Pro，4核物理CPU。

| 打包工具                 |  时间      |
| ----------------------- | --------- |
| browserify              | 22.98s    |
| webpack                 | 20.71s    |
| **parcel**              | **9.98s** |
| **parcel - 开启缓存** | **2.64s** |

## 为什么需要Parcel？
  
目前已经有很多的打包工具了，包括webpack和browserify。那么为什么我们还需要另外一个呢？主要原因是因为开发者的经验。

许多的打包工具都是围绕着配置和插件构建的，而且为了让应用正常的工作，超过500行的配置并不罕见。这些配置不仅繁琐而且耗时。通常情况下，这可能导致次优化的应用发送到生产环境。parcel被设计成零配置的：只需要将它指向应用程序的入口点，它就能正常工作。

目前现存的打包工具都非常慢。拥有大量文件和依赖的大型应用可能需要花费几分钟的时间来构建，这在开发过程中随着时间的变化而变得尤为痛苦。监听文件变更能够帮助重新构建，但初始的启动仍然非常慢。parcel利用工作线程编译你的代码，利用现代的多核处理器能力。这导致了初始构建的速度大大提升。它还具有一个文件系统缓存，可以保存每一个文件的编译结果，以便后续能够更快的启动。

最后，现有的打包工具都是围绕字符串加载/转换构建的，其中转换需要一个字符串，解析它，进行一些转换，然后再次生成代码。通常这样会导致许多的解析和代码生成在单个文件上运行，这是非常低效的。相反，parcel的转换工作在AST上，因此每个文件只有一个解析，多个转换以及一个代码生成。

## Parcel如何工作的？

parcel将资源树转换为bundle树。许多其它的打包工具基本上都是基于js资源，其它格式都是粘贴的-例如，默认情况下以字符串的形式内嵌到js中。parcel是文件类型无关的-它可以按照你期望的方式与任何类型的资源一起工作，无需配置。

parcel将一个入口点作为输入，可以是任何类型的：JS文件，HTML，CSS，图片等。在parcel中定义了各种资源类型，它们知道如何处理特定的资源类型。资源文件被解析，它的依赖关系被提取，并转换成最终的编译形式。这创建了一个资源树。

一旦资源树被构建，资源就被放入一个bundle树中。为入口资源创建一个bundle，并为动态导入的资源创建子bundle，这回导致代码拆分的发生。当导入不同类型的资源的时候就会创建子bundle，例如如果你在js中导入css文件，它就会打包成对应js的兄弟bundle。如果一个资源需要多个bundle，它会被打包到最近的共同祖先，因此它不会被包含多次。

在构建bundle树之后，每一个包都有特定的文件类型的包装器写入文件。

原文地址：https://github.com/parcel-bundler/parcel



