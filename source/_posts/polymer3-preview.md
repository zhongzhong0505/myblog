---
title: Polymer3.0预览版：npm和es6模块
date: 2017-11-15 23:11:27
tags: [es6,polymer]
---

## Polymer3.0预览版
今天在哥本哈根举行的2017Polymer大会上，我们宣布了该项目历史上最大的一次开发流程的变更。事实上，是两个变更：
* Polymer将从Bower迁移到npm
* 使用es6的模块替代HTML导入

<!-- more -->
我们目前正在预览这些更改 - 这些更改将包含在Polymer的下一个主版本中，因此，我们可以从预览版中获得反馈，然后继续公开进行。
通过一切手段，在预览版中实验。目前，对于正式的生产环境，建议继续使用Polymer 1.X或者2.X版本。如果你打算开始一个新的项目，我们建议
使用Polymer2.X。

虽然这些变化非常大，但我们致力于尽可能的实现无缝过渡。Polymer3.0的API将和2.X的API基本相同。只要API的变更是必要的，我们希望变更最小，并且易于应用。
作为Polymer 2.X中的类，混合，元素，模板系统和其它API都将被移植到模块中，包括在Polymer 1.X中的传统语法。所有Polymer开发者之前所学习的知识，在3.0中
都能够继续使用 。

我们还将提供一个叫做Polymer Modulizer的工具，帮助你将当前的元素和应用程序转换为Polymer 3.0。该工具将作为预览版的一部分，立即提供给开发者。并且已经针对Polymer库和全套
的Polymer元素进行了测试。

今天的文章描述了我们在Polymer 3.0变化背后的推理，以及在稳定版发布之前的下一步工作。明天，我们会让您开始使用预览代码进行实际操作。

## 我们为什么要切换到npm和es6模块？

从Polymer早期开始，我们就是使用Bower和HTML imports来管理依赖关系：Bower安装依赖关系，并使用HTML imports来加载它们。如果你使用基于HTML imports的工作流程，如Polymer和遵循Polymer
规范的第三方Web组件，这些技术已经非常成功。但是他们将我们置于Web开发的主流之外，并且对于那些使用其它框架或者构建工具的人们来说变得很难。

在另一方面，迁移到ES6模块和npm有一系列的优势：

* Polymer变得和大量js开发人员熟悉的工作流程和工具更加兼容。
* 在最新版本的Chrome，Opera和Safari中，Polymer元素和应用程序不会运行任何的polyfills。当使用Edge和Firefox发布自定义元素和Shadow Dom时，Polymer将在这些浏览器中运行polyfills。
* 无论你是将Polymer元素导入到库中，还是在元素的内部使用一个库，都可以非常方便的处理常规js库。

以下各节将更深入的描述这些更改。

## HTML Imports -> ES6 模块

从一开始，Polymer就使用HTML Imports来加载依赖关系。HTML Imports导入有很多好处：

* Web本地加载机制。使用HTML Imports不需要构建工具。
* 有序的执行依赖关系。也就是说，如果A依赖B，B依赖C，则C在B和A之前被加载和执行。
* 通过URL重复删除依赖关系。即使导入了多次，每个导入也只下载一次，并且只执行一次。
* 本地HTML解析。

但是HTML Imports在标准委员会和其它浏览器中没有得到好的推广。虽然有对候选推荐规范进行积极的讨论，但是任何新的标准出现都将在几年之后。输入ES6模块。
ECMAScript 2015标准（也被称为ECMAScript 6或者ES6）为js引入了本地模块和模块加载系统。并最终在所有主流浏览器中获得了支持。它们在Safari，Chrome和FIrefox和Edge中都得到了支持。

ES6模块允许js文件导入其它文件，导致它们被浏览器加载并执行。ES6模块加载行为和HTML Imports几乎相同：

* Web本地加载机制。
* 有序执行依赖关系。
* 通过URL重复删除依赖关系。

ES6模块中明显缺少的一个HTML Imports特性就是本地加载和解析导入的HTML。我们希望平台能够重新获取这个功能，但是当标准展开讨论时，我们相信采用广泛采用的ES6模块标准对于我们的开发
人员和用户来说是最好的。

与此同时，在js中表示HTML有一系列合理的选择，我们期待社区一起探索这些选项。

## Bower -> npm

像HTML Imports一样，我们使用Bower已经很久了。Bower的扁平化的依赖树是目前前端项目的理想选择。但是Bower从来没有像npm那样被广泛采用，虽然被保持不变了，但是Bower已经不再被积极开发了。

迁移到npm将是的Polymer软件包可以无缝的提供给数百万的用户使用，并且允许Polymer软件包轻松的使用npm生态系统中的其它软件包。

这一直是一个长期的request feature。但是我们一直在等待，直到我们有了很好的解决方案来支持模块的扁平化安装，并保持Bower和npm的同步。

yarn npm客户端提供了扁平化安装的支持，解决了npm的第一个issue（#1 github上的issue）。

在考虑了多种保持Bower和npm包同步的方法之后，我们得出结论认为保持并行版本是不切实际的。所以我们在3.x中做了一个彻底的改变，并且专门迁移到了npm。

## 什么时候会发生？

你先可以预览库和元素的新版本，但是任然有许多需要整合到一起的以发布一个完整的产品版本。
现在，我们有：
* Polymer核心库和发布到了npm中的元素的预览版本。
* 用于将Bower和基于HTML导入的项目转换为npm和JavaScript模块的Polymer Modulizer工具。
* 在Polymer serve中支持npm的包。

在发布Polymer3.0之前，我们还需要做很多的事情：

* 我们希望至少有一个浏览器支持模块，包括动态导入。（Safari 10.1和Chrome 61已经支持模块，但不支持动态导入）。
* 我们需要做更全面的测试 - 对ES6模块的本地支持还处于初期和相对未知的阶段。
* 我们需要完成更新模块和npm的Polymer cli和相关工具。
* 我们需要编写稳定，实例，模板和所有的干货。
* 最重要的是，我们需要你的反馈意见，投入和参与，以帮助Polymer的改进。我们还需要你的帮助才能是的第三方的Web组件向蓬勃的生态系统过渡。

## 下一步是什么？

我们希望你能像Polymer预览版一样兴奋，我们希望得到你的反馈。


原文地址：
https://www.polymer-project.org/blog/2017-08-22-npm-modules.html
