---
title: 【Lua学习笔记】Lua中的基本数据类型介绍
date: 2019-08-07 11:30:00
tags: [lua]
---

## 数据类型

Lua语言的数据类型非常丰富，包括nil、boolean、number、string、userdata、function、thread 和 table等类型。Lua中所有的数据类型的默认值都是nil。

### nil 
只有一个值，就是nil本身。

### boolean类型
跟其他语言一样，包括false和true俩个值。
在lua语言中，只有nil和false的值为“假”，其他的都是“真”
<!-- more -->

### number类型
number类型表示双精度浮点数字，lua中没有整数类型，所有的数字类型都是number，这个跟js其实是一样的。
我们可以省略小数部分和指数部分，下面这些都是有效的number类型。
```
  4     0.4     4.57e-3     0.3e12     5e+20
```

### string类型

首先String在lua中是不可能的值，这个跟大多数语言中的string类型设计是一样的，比如Java和JavaScript，Go等等（C语言的string是可变的）。
所以，如果在lua中你需要修改一个字符串，你可以像下面这样，重新生成一个新的字符串。
```lua
    a = "one string"
    b = string.gsub(a, "one", 'another')  -- 讲one替换为another
    print(a)       --> one string
    print(b)       --> another string
```
注意看上面的代码，单引号和双引号都可以表示一个字符串。这点跟js也一样。

在lua中，lua会自动管理字符串的内存释放和回收，所以不用担心内存问题。

在lua中，字符串里面可以包含转义字符，和js不同的是，lua中可以使用转义的数字来表示ASCII编码。举个例子：

```lua
"alo\n123\""
'\97lo\10\04923"'
```
上面这两个字符串是相等的，因为a的ASCII码是97，换行符\n的ASCII码是10，数字1的ASCII码是49。所以上面的两个字符串是完全一样的。

lua中如果想表示多行字符串，可以使用[[...]]，并且可以嵌套。但是这种字符串表示，不会去解析转义字符。
```lua
[[
    <div>
        <span>hello</span>
        <p>
            ....
        </p>
    </div>
]]
```

lua中对于字符串的任何数字操作，都会尝试将字符串转换为数字类型。
```lua
    print("10" + 1)           --> 11
    print("10 + 1")           --> 10 + 1
    print("-5.3e-10"*"2")     --> -1.06e-09
    print("hello" + 1)        -- 错误：stdin:1: attempt to perform arithmetic on a string value
    print(1 + "hello")        -- 错误：stdin:1: attempt to perform arithmetic on a string value
```

这里跟js里面还是有区别的，js里面，第一个会输出“101”，第四个会输出“hello1”，第五个会输出“1hello”。

与上面相反，lua中对于数字的任何字符串操作，都会讲数字转换为字符串。
```lua
    print(1 .. 3) --> 13
```
这里的..是lua中的字符串相加的操作。注意..前的空格，否则会被当做是前一个数字的小数点。后面的空格没有关系。

对于上面，你会觉得lua中的字符串和数字会自动转换，那比较的时候，是否也会自动转换呢？答案是不会转换。
```lua
    print(1 == "1") --> false
```

我们知道在js里面如果使用1=='1'来判断是否相等，会返回true，必须使用===来使用强相等的判断，这点lua中不需要。lua中会直接判断类型是否相同，
如果不同直接返回false。\

如果需要字符串和数字比较，那就需要先将字符串转换为数字或者将数字转换为字符串：
```lua
    print(1 == tonumber('1')) --> true
    print(tostring(1) == '1') --> true
```
tonumber和tostring不用说你也知道是干嘛的。
官方文档：https://www.lua.org/pil/2.4.html
### Table类型
lua中的table类型有点类似js中的对象，但是比js中的对象更加强大。它可以表示数组，set，队列等各种数据结构。lua中的table是引用类型，这意味着不会存在数据复制和拷贝的问题。操作table就是在操作指针，背后也没有副本或者新table的创建。

声明一个table非常简单：
```lua
    a = {} --> 声明一个table
```
然后可以给这个table各种操作：
```lua
    a[1] = "1"
    a["k"] = "v"
```

基本上你在js里面怎么使用对象，这里就可以怎么使用lua的table，是不是很简单？

再来看个例子：
```js
    const a = {};
    a['1'] = 1; 
    a[1] = 2; 
    console.log(a[1]) // 2
    console.log(a['1'])  // 2
```

```lua
    a = {}
    a['1'] = 1
    a[1] = 2
    print(a[1]) --> 2
    print(a['1']) --> 1
```
注意上面这一个区别，js中是会将key转换为字符串的。而在lua中，是不会的。

除了上面这种a[1]形式访问table中的属性外，还可以通过a.x,a.y的形式访问，但是注意，x，y不能是数字。所以上面的a[1]和a['1']都不能使用这种形式。

注意：
a.x和a.y这种形式，是通过x，y的值去访问table中的属性，而a[x]和a[y]是通过x，y本身作为索引去访问table，这里是有区别的：
```lua
    x = 10
    a = {}
    a[x] = 1
    a.x = 2
    print(a[x]) --> 1，这里的key是10
    print(a.x) --> 2，这里的key是“x”
```
这个跟js里面是一样的。

遍历table

```lua
    a = {}
    a[0] = 'one'
    a[1] = 'two'
    a[2] = 'three'
    for i,line in ipairs(a) do
        print(i .. '-->' .. line)
    end
```

上面的代码输出如下：
```lua
1-->two
2-->three
```

为什么0不见了呢？因为在lua语言中，索引是从1开始的，这是一个约定，所有内建的函数和功能都是这个约定。
上面的代码你可以通过a[0]来显示访问到这个值。不过建议不要这么做。


### function类型
function类型是lua中的一等公民。嗯，js里面是不是也是这样？
声明一个函数：
```lua
function add (a)
    local sum = 0
    for i,v in ipairs(a) do
        sum = sum + v
    end
    return sum
end
```

函数调用：
```lua
    a={}
    a[1]=1
    a[2]=2
    add(a) --> 3
```

官方文档：https://www.lua.org/pil/2.5.html

